# Personalized Children's Storybook Creator

An AI-powered web application that creates personalized illustrated children's storybooks featuring your child as the hero of their own adventure.

## Features

- üé® **AI-Generated Illustrations** - Powered by Google Gemini 2.5 Flash
- üìñ **Custom Stories** - Personalized narratives generated by Google Gemini 2.0 Flash
- üéØ **Multiple Templates** - Choose from various story themes (space adventures, magical forests, ocean exploration, etc.)
- üêæ **Pet Inclusion** - Add your family pets to the story
- üìö **Professional PDFs** - Download or order printed books
- üîí **Privacy-First** - Child photos are encrypted and automatically deleted after 24 hours

## Tech Stack

- **Frontend**: Next.js 14 (App Router), React 18, TypeScript, Tailwind CSS
- **Authentication & Database**: Supabase (PostgreSQL + Auth)
- **AI Generation**: Google Gemini API (2.0 Flash for text, 2.5 Flash for images)
- **Background Processing**: Vercel Cron Jobs (no Redis/BullMQ required)
- **PDF Generation**: PDFKit
- **Storage**: Supabase Storage (or AWS S3)
- **Payments**: Stripe
- **Deployment**: Vercel

## Getting Started

### Prerequisites

- Node.js 20+
- Docker (for local Supabase)
- Google Gemini API key
- Stripe account (for payments)
- Supabase account (provides database + storage)

### Installation

1. Clone the repository:
```bash
git clone https://github.com/paragondesignz/childrens-book-creator.git
cd childrens-book-creator
```

2. Install dependencies:
```bash
npm install
```

3. Copy environment variables:
```bash
cp .env.example .env
```

4. Start Supabase locally:
```bash
supabase start
```

5. Apply database migrations:
```bash
supabase db reset
```

6. Update `.env` with your API keys:
- Add your Google Gemini API key
- Add your AWS credentials
- Add your Stripe keys
- Other service credentials as needed

7. Start the development server:
```bash
npm run dev
```

8. Open [http://localhost:3000](http://localhost:3000) in your browser.

**Note**: Background processing uses Vercel Cron in production. For local development, you can manually trigger processing via the `/api/cron/process-books` endpoint.

## Environment Variables

See `.env.example` for the complete list of required environment variables.

**Critical variables:**
- `NEXT_PUBLIC_SUPABASE_URL` - Your Supabase project URL
- `NEXT_PUBLIC_SUPABASE_ANON_KEY` - Your Supabase anon key
- `SUPABASE_SERVICE_ROLE_KEY` - Supabase service role key (for server-side operations)
- `GEMINI_API_KEY` - Google Gemini API key
- `STRIPE_SECRET_KEY` - Stripe secret key
- `NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY` - Stripe publishable key

## Database Schema

The application uses Supabase PostgreSQL with the following main tables:

- `users` - User accounts (extends Supabase auth)
- `story_templates` - Pre-built story templates
- `book_orders` - Book creation requests
- `generated_stories` - AI-generated story content
- `generated_images` - AI-generated illustrations
- `generated_pdfs` - Final PDF books
- `payments` - Stripe payment records

See `supabase/migrations/` for the complete schema.

## Development Commands

```bash
# Development
npm run dev                # Start Next.js dev server
supabase start            # Start local Supabase
supabase stop             # Stop local Supabase

# Database
supabase db reset         # Reset database and apply migrations
supabase db push          # Push schema changes
supabase db seed          # Seed story templates

# Testing
npm test                  # Run tests
npm run test:coverage     # Run tests with coverage
npm run type-check        # TypeScript type checking
npm run lint              # Lint code

# Build
npm run build             # Build for production
npm start                 # Start production server
```

## How It Works

1. **User Creates Book** - Parents upload a photo of their child, select a story template or create a custom prompt, and add personalization details
2. **Payment Processing** - Secure payment via Stripe for digital PDF or printed book
3. **Background Generation**:
   - Story text generated by Gemini 2.0 Flash (~30-60 seconds)
   - 15 illustrations generated by Gemini 2.5 Flash (~7-15 minutes)
   - Professional PDF created with PDFKit (~30-60 seconds)
4. **Delivery** - User receives notification when book is ready for download/delivery

## Security & Privacy

- **Photo Security**: Child photos are encrypted (AES-256-GCM) and auto-deleted after 24 hours
- **Row Level Security**: Supabase RLS policies ensure users can only access their own data
- **Content Moderation**: Multi-layer content safety checks
- **GDPR Compliant**: Data export and deletion features built-in

## Architecture

The application follows a simplified serverless architecture optimized for Vercel:

```
Frontend (Next.js)
    ‚Üì
API Routes (Next.js API)
    ‚Üì
Services Layer (Story, Image, PDF Generation)
    ‚Üì
Vercel Cron (runs every 5 minutes) ‚Üí Process pending books
    ‚Üì
External APIs (Gemini, Stripe, Supabase Storage)
```

**Key Design Decisions:**
- **No Redis/BullMQ**: Uses Vercel Cron for background processing instead of maintaining a separate queue infrastructure
- **Serverless-First**: All processing happens within Vercel's serverless functions
- **Status-Based Processing**: Books marked as "processing" are picked up by the cron job automatically
- **Simple & Reliable**: Fewer moving parts = easier to maintain and debug

See `CLAUDE.md` for detailed architecture documentation.

## Deployment

### Vercel Deployment

1. Install Vercel CLI:
```bash
npm i -g vercel
```

2. Deploy:
```bash
vercel
```

3. Add environment variables in Vercel dashboard

### Supabase Production

1. Create a Supabase project at [supabase.com](https://supabase.com)
2. Link your project:
```bash
supabase link --project-ref your-project-ref
```
3. Push migrations:
```bash
supabase db push
```

## Contributing

This is a private project. Please contact the repository owner for contribution guidelines.

## License

Proprietary - All rights reserved

## Support

For issues and questions, please contact the repository maintainers.

---

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)
